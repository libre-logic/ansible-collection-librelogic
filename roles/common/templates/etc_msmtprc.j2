# msmtp system wide configuration file
# This allows msmtp to be used like /usr/sbin/sendmail.

# msmtp supports multiple accounts
# This configures the default account
account default

# TCP port to use
# Usually 25 (SMTP), 465 (SMTPS) or 587 (submission)
port {{ msmtp_smtp_port }}

# The SMTP smarthost.
host {{ msmtp_smtp_host }}

{% if msmtp_from == 'auto' %}
{% if (ansible_distribution == 'Debian' and ansible_distribution_release == 'buster') %}from %U@%H
{% else %}auto_from on
{% endif %}
{% else %}
from {{ msmtp_from }}
{% endif %}

{% if msmtp_auth_enabled %}
# Enable authentication
auth on
# Set SMTP username/password
user {{ msmtp_smtp_user }}
password {{ msmtp_smtp_password }}
{% endif %}

# Use TLS.
{% if msmtp_tls_enabled %}
tls on
tls_starttls {{ 'on' if msmtp_starttls else 'off' }}
{% if msmtp_tls_certcheck %}
{% if msmtp_smtp_host_tls_fingerprint is defined %}
tls_fingerprint {{ msmtp_smtp_host_tls_fingerprint }}
{% else %}
tls_trust_file /etc/ssl/certs/ca-certificates.crt
{% endif %}
{% else %}
tls_certcheck off
{% endif %}
{% endif %}


# Syslog logging with facility LOG_MAIL instead of the default LOG_USER.
syslog LOG_MAIL

# Replace local recipients with addresses in the aliases file
aliases /etc/aliases
